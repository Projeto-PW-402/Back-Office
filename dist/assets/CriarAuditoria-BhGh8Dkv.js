var E=Object.defineProperty;var O=(c,i,r)=>i in c?E(c,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[i]=r;var o=(c,i,r)=>O(c,typeof i!="symbol"?i+"":i,r);import{d as Q,r as d,y as j,K as P,R as K,i as L,S as G,c as b,o as v,f as H,a,e as n,v as p,u,Q as x,F as V,E as I,P as J,w as W,I as h,U as X,t as A,g as Y}from"./index-Be-DcD_X.js";import{N as Z}from"./Navbar-D1txnyHR.js";import{a as $,f as tt,u as at}from"./materialService-EQM2v9Ok.js";import{a as et,b as ot,u as st}from"./userService-BPWHVbBk.js";import{I as N}from"./index-BOAzHGzj.js";import{b as it,e as lt}from"./auditoriasService-CUiB3gN0.js";import{_ as dt}from"./plugin-vueexport-helper-DlAUqK2U.js";class nt{constructor(i){o(this,"id",0);o(this,"nome","");o(this,"tipo","");o(this,"descricao","");o(this,"images",[]);o(this,"files",[]);o(this,"materiais",[]);o(this,"risco",0);o(this,"dnome","");o(this,"dnif","");o(this,"dcontacto","");o(this,"demail","");o(this,"location","");o(this,"status",-1);o(this,"date","");o(this,"lat","");o(this,"lng","");Object.assign(this,i)}}const rt={class:"main-container"},ut={class:"inputs-container"},ct={class:"top-inputs"},bt={class:"top-left-cotainer"},vt={class:"form"},pt={class:"tl-top-form"},mt={class:"nome-container tl-input"},ft={class:"origem-container tl-input"},yt={class:"tipo-container tl-input"},gt={class:"descricao-container tl-input"},ht={class:"top-right-cotainer"},_t={class:"tr-body-scroll"},Ut={class:"tr-table"},kt=["value","disabled"],Mt={key:0},wt={key:1,style:{color:"lightgray"}},qt={class:"bottom-inputs"},xt={class:"bottom-left-container"},At={class:"bl-body-scroll"},Vt={class:"bl-table"},It=["onUpdate:modelValue","max"],Nt={class:"bottom-right-container"},St={class:"form"},Rt={class:"first-layer"},zt={class:"data-container"},Ct={class:"selector-container"},Bt={class:"inicio-container"},S=!0,Dt=Q({__name:"CriarAuditoria",setup(c){console.log("Dev Mode:",S);const i=d(""),r=d(""),_=d("1"),R=Y(),z=P(),g=j(()=>Number(z.params.id));console.log("ID da Auditoria:",g.value);const y=d([]),U=K({}),k=d([]),C=d("");async function B(){try{k.value=Object.entries(U).filter(([l,t])=>t>0).map(([l,t])=>({id:Number(l),quantidade:t}));for(const l of k.value){const t=await tt(l.id);t&&(t.quant-=l.quantidade),await at(l.id,t),s.materiais.push({id:l.id,quantidade:l.quantidade})}for(const l of y.value){const t=await ot(l);t&&(t.listaAuditorias.push(g.value),await st(l,t))}s.date=i.value+" "+r.value,s.status=1,s.risco=parseInt(_.value),await lt(g.value,s),S&&(console.log("Materiais Selecionados",k.value),console.log("Utilizadores Selecionados",y.value),console.log("Auditoria Atualizada:",s)),R.push({path:"/auditorias/pedidos"})}catch{return}}const m=d([]);async function D(){m.value=await et(),m.value.length===0?m.value=[]:(console.log("Utilizadores:",m.value),console.log("Selecionados:",y))}const f=d([]);async function F(){f.value=await $(),f.value.length===0?f.value=[]:console.log("Materiais carregados com sucesso:",f.value)}let s=new nt;async function T(){if(s=await it(g.value),s==null){C.value="Auditoria não encontrada";return}}const M=d(null),w=d(null);return L(async()=>{await D(),await F(),M.value&&N(M.value,{mask:"00/00/0000"}),w.value&&N(w.value,{mask:"00:00",lazy:!0}),console.log("Utilizadores carregados:",m.value),console.log("Materiais carregados:",f.value),console.log("Auditoria carregada:",s)}),G(async()=>{await T()}),(l,t)=>(v(),b("div",rt,[H(Z,{page:3,disable:!0}),a("form",{id:"auditoriaForm",onSubmit:W(B,["prevent"])},[a("div",ut,[a("div",ct,[a("div",bt,[t[12]||(t[12]=a("div",{class:"little-title"},"Pedido",-1)),a("div",vt,[a("div",pt,[a("div",mt,[n(a("input",{type:"text",id:"nome","onUpdate:modelValue":t[0]||(t[0]=e=>u(s).nome=e),disabled:"",required:""},null,512),[[p,u(s).nome]]),t[8]||(t[8]=a("label",{class:"nome-label",for:"nome"},"Nome",-1))]),a("div",ft,[n(a("input",{type:"text",id:"origem","onUpdate:modelValue":t[1]||(t[1]=e=>u(s).location=e),disabled:"",required:""},null,512),[[p,u(s).location]]),t[9]||(t[9]=a("label",{class:"origem-label",for:"origem"},"Origem",-1))])]),a("div",yt,[n(a("input",{type:"text",id:"tipo","onUpdate:modelValue":t[2]||(t[2]=e=>u(s).tipo=e),disabled:"",required:""},null,512),[[p,u(s).tipo]]),t[10]||(t[10]=a("label",{class:"tipo-label",for:"tipo"},"Tipo",-1))]),a("div",gt,[n(a("input",{type:"text",id:"descricao","onUpdate:modelValue":t[3]||(t[3]=e=>u(s).descricao=e),disabled:"",required:""},null,512),[[p,u(s).descricao]]),t[11]||(t[11]=a("label",{class:"descricao-label",for:"descricao"},"Descrição",-1))])])]),a("div",ht,[t[13]||(t[13]=x('<div class="little-title" data-v-a61cb8b3>Equipa</div><table class="tr-table" data-v-a61cb8b3><thead class="tr-table-header" data-v-a61cb8b3><tr data-v-a61cb8b3><th class="tr-h" data-v-a61cb8b3>Selecionar</th><th class="tr-h" data-v-a61cb8b3>Trabalhador</th></tr></thead></table>',2)),a("div",_t,[a("table",Ut,[a("tbody",null,[(v(!0),b(V,null,I(m.value,e=>(v(),b("tr",{key:e.id},[a("td",{class:"tr-d",style:h({backgroundColor:e.id%2==0?"transparent":"#d3dce6"})},[n(a("input",{type:"checkbox",class:"form-check-input",value:e.id,"onUpdate:modelValue":t[4]||(t[4]=q=>y.value=q),disabled:!e.allowed},null,8,kt),[[X,y.value]])],4),a("td",{class:"tr-d",style:h({backgroundColor:e.id%2===0?"transparent":"#d3dce6"})},[e.allowed==!0?(v(),b("div",Mt,A(e.nome),1)):(v(),b("div",wt,A(e.nome),1))],4)]))),128))])])])])]),a("div",qt,[a("div",xt,[t[14]||(t[14]=x('<div class="little-title" data-v-a61cb8b3>Materiais</div><table class="bl-table" data-v-a61cb8b3><thead class="bl-table-header" data-v-a61cb8b3><tr data-v-a61cb8b3><th class="bl-h" data-v-a61cb8b3>Material</th><th class="bl-h" data-v-a61cb8b3>Quantidade</th></tr></thead></table>',2)),a("div",At,[a("table",Vt,[a("tbody",null,[(v(!0),b(V,null,I(f.value,e=>(v(),b("tr",{key:e.id},[a("td",{class:"bl-d",style:h({backgroundColor:e.id%2===0?"transparent":"#d3dce6"})},A(e.nome),5),a("td",{class:"bl-d",style:h({backgroundColor:e.id%2===0?"transparent":"#d3dce6"})},[n(a("input",{type:"number","onUpdate:modelValue":q=>U[e.id]=q,min:"0",max:e.quant,placeholder:"0"},null,8,It),[[p,U[e.id],void 0,{number:!0}]])],4)]))),128))])])])]),a("div",Nt,[t[20]||(t[20]=a("div",{class:"little-title"},"Finalizar",-1)),a("div",St,[a("div",Rt,[a("div",zt,[n(a("input",{ref_key:"inputRef",ref:M,"onUpdate:modelValue":t[5]||(t[5]=e=>i.value=e),placeholder:"dd/mm/yyyy",class:"form-control",type:"text",required:""},null,512),[[p,i.value]]),t[15]||(t[15]=a("label",{class:"data-label",for:"data"},"Data",-1))]),a("div",Ct,[n(a("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>_.value=e),class:"selector",required:""},t[16]||(t[16]=[x('<option value="1" selected data-v-a61cb8b3>1</option><option value="2" data-v-a61cb8b3>2</option><option value="3" data-v-a61cb8b3>3</option><option value="4" data-v-a61cb8b3>4</option><option value="5" data-v-a61cb8b3>5</option>',5)]),512),[[J,_.value]]),t[17]||(t[17]=a("label",{class:"Nivel Risco",for:"risco"},"Nivel de Risco",-1))])]),a("div",Bt,[n(a("input",{type:"text",id:"inicio",placeholder:"","onUpdate:modelValue":t[7]||(t[7]=e=>r.value=e),ref_key:"inputTimeRef",ref:w,class:"form-control",required:""},null,512),[[p,r.value]]),t[18]||(t[18]=a("label",{class:"inicio-label",for:"inicio"},"Inicio",-1))]),t[19]||(t[19]=a("button",{type:"submit",class:"btn btn-primary"},"Finalizar",-1))])])])])],32)]))}}),Lt=dt(Dt,[["__scopeId","data-v-a61cb8b3"]]);export{Lt as default};
